<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" th:href="@{/styles/table.css}">
  <link rel="stylesheet" th:href="@{/styles/centered-table-search-bar.css}">
  <link rel="stylesheet" th:href="@{/styles/hide-cloack.css}">
  <th:block th:replace="~{fragments/layout.html :: config}"></th:block>
</head>
<body>
<div x-data="viewData" x-init="await initialize()">

  <div th:replace="~{fragments/header.html:: header(previousView)}"></div>
  <div class="container-flex d-flex align-items-center flex-column">
    <h1 x-text="labelAddQuestion"></h1>
    <div class="w-50 d-flex flex-column">
      <label for="questionText" class="w-100">Question text</label>
      <textarea id="questionText" rows="3" class="w-100"></textarea>
    </div>
    <div class="w-50 d-flex flex-column mt-20">
      <label for="questionDescription" class="w-100">Question description</label>
      <textarea id="questionDescription" rows="3" class="w-100"></textarea>
    </div>
    <div class="container-flex d-flex align-items-start w-100">
      <div class="w-25"></div>
      <div class="w-50">
        <h2>Criterias</h2>
        <div class="d-flex w-90">
          <button type="button" class="btn btn-info">New</button>
          <button type="button" class="btn btn-danger">Delete</button>
          <button type="button" class="btn btn-success">Save</button>
        </div>
      </div>
    </div>
  </div>

</div>
</body>

</html>

<script type="text/javascript" src="/js/services/ApiService.js"></script>
<script th:inline="javascript">
    document.addEventListener('alpine:init', () => {
      Alpine.data('viewData', () => ({
        previousView: "/edit-subject-view?subjectName=" + /*[[${subjectName}]]*/ '',
        professor: JSON.parse(localStorage.getItem("professorInfo")),
        subject: {},
        currentTopic: {},
        currentQuestion: {},
        labelAddQuestion: "",

        async initialize() {
          this.getSubjectInfo().then(() => {
            this.setCurrentTopic(/*[[${topicId}]]*/ '');
            this.labelAddQuestion = "Add question to " + this.currentTopic.name + " topic";
          });
        },

        setCurrentTopic(topicId) {
          console.log("Current topic id: " + topicId);
          this.currentTopic = this.subject.topics.find(topic => topic.id == topicId);
        },

        changeView(view) {
          window.location.href = view;
        },

        async getSubjectInfo() {
          let subjectName = /*[[${subjectName}]]*/ '';
          let subject = await ApiService.getRequest("subjects/subject/" + subjectName);
          this.subject = await subject.json();
        },
      }));
    });
  </script>