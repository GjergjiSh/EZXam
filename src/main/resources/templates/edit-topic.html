<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" th:href="@{/styles/table.css}">
  <link rel="stylesheet" th:href="@{/styles/centered-table-search-bar.css}">
  <link rel="stylesheet" th:href="@{/styles/hide-cloack.css}">
  <th:block th:replace="~{fragments/layout.html :: config}"></th:block>
  <style>
    .container-flex {
      display: flex;
      align-items: center;
    }
  </style>
</head>

<body>
<div x-data="viewData" x-init="await initialize()">

  <div th:replace="~{fragments/header.html:: header(previousView)}"></div>

  <div class="container-flex d-flex align-items-center flex-column">
    <h1 x-text="currentTopic.name"></h1>
    <div class="mr-30 mt-10" th:replace="~{fragments/search-bar.html :: searchBar('question-description')}"></div>

    <table class="table centred-table" id="subjectTopicsQuestions-table">
      <thead>
      <tr>
        <th scope="col">Question</th>
        <th scope="col"></th>
        <th scope="col" class="d-flex justify-content-end">
          <button type="button" class="btn btn-primary">Insert new question</button>
        </th>
      </tr>
      </thead>
        <tbody>
        <template x-for="question in currentTopic.questions" :key="question.id">
          <tr>
            <td x-text="question.description" id="question-description"></td>
            <td x-text="question.text" id="question-text"></td>
            <td class="align-middle">
              <div class="row-buttons">
                <button @click="editQuestion()" class="edit-button btn btn-secondary">Edit</button>
                <button @click="deleteQuestion()" class="btn btn-danger">Delete</button>
              </div>
            </td>
          </tr>
        </template>
        </tbody>
    </table>
  </div>
</div>
</body>
</html>

<script type="text/javascript" src="/js/services/ApiService.js"></script>
<script th:inline="javascript">
    document.addEventListener('alpine:init', () => {
      Alpine.data('viewData', () => ({
        previousView: "/edit-subject-view?subjectName=" + /*[[${subjectName}]]*/ '',
        professor: JSON.parse(localStorage.getItem("professorInfo")),
        subject: {},
        currentTopic: {},

        async initialize() {
          this.getSubjectInfo().then(() => {
            this.setCurrentTopic(/*[[${topicName}]]*/ '');
          });
        },

        setCurrentTopic(topicName) {
          console.log("Current topic name: " + topicName);
          this.currentTopic = this.subject.topics.find(topic => topic.name === topicName);
        },

        changeView(view) {
          window.location.href = view;
        },

        async getSubjectInfo() {
          let subjectName = /*[[${subjectName}]]*/ '';
          let subject = await ApiService.getRequest("subjects/subject/" + subjectName);
          this.subject = await subject.json();
        },

        editQuestion() {

        },

        deleteQuestion() {

        },
      }));
    });
  </script>